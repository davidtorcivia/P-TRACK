# Quick Reference Card

## üöÄ Getting Started (5 Minutes)

```bash
# 1. Run setup script
chmod +x setup.sh && ./setup.sh

# 2. Start the application
make docker-up

# 3. Check it's running
curl http://localhost:8080/health
```

**Access**: http://localhost:8080 (or https://localhost:443 if SSL configured)

---

## üìÇ Key Files

| File | Purpose |
|------|---------|
| `cmd/server/main.go` | Main application - **THIS IS WHERE YOU'LL WORK NEXT** |
| `.env` | Configuration (auto-generated by setup.sh) |
| `migrations/001_initial_schema.sql` | Database schema |
| `GETTING_STARTED.md` | Detailed next steps guide |
| `IMPLEMENTATION_STATUS.md` | What's done vs. what's not |

---

## üõ†Ô∏è Common Commands

### Development
```bash
make run              # Run locally (fast iteration)
make dev              # Run with auto-reload (requires air)
make build            # Build binary
make test             # Run tests
make fmt              # Format code
```

### Docker
```bash
make docker-up        # Start containers
make docker-down      # Stop containers
make docker-logs      # View logs
make docker-rebuild   # Rebuild and restart
```

### Database
```bash
sqlite3 data/tracker.db          # Open database
make backup                       # Create backup
```

---

## üìä Project Status

**Overall Completion**: 25% ‚úÖ

### ‚úÖ Complete
- Security infrastructure (CSRF, rate limiting, JWT, bcrypt)
- Database schema (13 tables)
- Docker deployment
- Configuration management
- All routes defined

### ‚è≥ Not Started
- Handler implementations (all return "Not implemented yet")
- Frontend templates
- Business logic
- Tests

---

## üîí Security Features (ALL IMPLEMENTED)

| Feature | Status | Config |
|---------|--------|--------|
| CSRF Protection | ‚úÖ | Auto-enabled for POST/PUT/DELETE |
| Rate Limiting | ‚úÖ | 5 login attempts per 15 min |
| JWT Auth | ‚úÖ | 2 week expiry |
| bcrypt | ‚úÖ | Cost factor 12 |
| Security Headers | ‚úÖ | CSP, HSTS, X-Frame-Options, etc. |
| HTTPS | ‚úÖ | Nginx redirect |
| SQL Injection Prevention | ‚úÖ | Prepared statements |
| Account Lockout | ‚úÖ | Schema ready |
| Audit Logging | ‚úÖ | Schema ready |

---

## üéØ Next Tasks (Priority Order)

### 1. Repository Layer (1-2 days)
Create `internal/repository/user_repository.go`:
```go
package repository

type UserRepository struct {
    db *database.DB
}

func (r *UserRepository) Create(user *models.User) error {
    // Use prepared statements
    stmt, _ := r.db.Prepare("INSERT INTO users ...")
    defer stmt.Close()
    // ... implement
}
```

Do the same for: courses, injections, inventory, etc.

### 2. Login Handler (1 day)
In `cmd/server/main.go`, implement `handleLogin`:
```go
func handleLogin(db *database.DB, jwtManager *auth.JWTManager) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // 1. Parse username/password
        // 2. Verify with bcrypt
        // 3. Check account lockout
        // 4. Generate JWT
        // 5. Set httpOnly cookie
        // 6. Log to audit table
    }
}
```

### 3. Injection Logging (2-3 days)
Implement `handleCreateInjection`:
```go
// 1. Validate input
// 2. Get active course
// 3. Insert injection
// 4. **Auto-decrement inventory** (critical!)
// 5. Log to audit table
// 6. Return success
```

### 4. Basic Frontend (3-5 days)
Create `templates/layouts/base.html`:
```html
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
    <script src="https://unpkg.com/htmx.org@latest"></script>
    <script src="https://unpkg.com/alpinejs@latest"></script>
</head>
<body>
    {{ block "content" . }}{{ end }}
</body>
</html>
```

---

## üß™ Testing Security

### Test CSRF Protection
```bash
# Should fail (no token)
curl -X POST http://localhost:8080/api/courses \
  -H "Authorization: Bearer fake-token" \
  -d '{"name":"Test"}'
# Returns: 403 Forbidden
```

### Test Rate Limiting
```bash
# Try 10 login attempts
for i in {1..10}; do
  curl -X POST http://localhost:8080/api/auth/login \
    -d '{"username":"test","password":"test"}'
done
# After 5 attempts: 429 Too Many Requests
```

### Test Security Headers
```bash
curl -I http://localhost:8080
# Should see: CSP, HSTS, X-Frame-Options, etc.
```

---

## üìã Database Tables

1. **users** - User accounts
2. **courses** - Treatment cycles
3. **injections** - Injection records
4. **symptom_logs** - Symptom tracking
5. **medications** - Medication definitions
6. **medication_logs** - Medication adherence
7. **inventory_items** - Current stock
8. **inventory_history** - Inventory changes
9. **settings** - App settings
10. **notifications** - User alerts
11. **audit_logs** - Security audit trail
12. **session_tokens** - JWT refresh tokens
13. **password_reset_tokens** - Password resets

---

## üîß Configuration (.env)

### Critical Settings
```bash
JWT_SECRET=<auto-generated>      # Keep secure!
CSRF_SECRET=<auto-generated>     # Keep secure!
DATABASE_PATH=./data/tracker.db
```

### Optional Settings
```bash
PORT=8080
SESSION_DURATION=336h            # 2 weeks
RATE_LIMIT_REQUESTS=100
LOGIN_RATE_LIMIT=5
SMTP_ENABLED=false              # Email for password reset
```

---

## üêõ Troubleshooting

### "Can't connect to database"
```bash
# Check database path
ls -la data/tracker.db

# Check permissions
chmod 644 data/tracker.db
```

### "Rate limited"
```bash
# Wait 15 minutes, or restart
docker-compose restart
```

### "Invalid JWT secret"
```bash
# Regenerate secrets
openssl rand -base64 32

# Update .env
JWT_SECRET=<new-secret>
```

### "Migration failed"
```bash
# Check migrations directory
ls migrations/

# View SQL errors
docker-compose logs app | grep -i error
```

---

## üìö Documentation

| Document | Use When |
|----------|----------|
| `QUICK_REFERENCE.md` | Quick lookup (this file) |
| `GETTING_STARTED.md` | Starting implementation |
| `IMPLEMENTATION_STATUS.md` | Checking what's done |
| `PROJECT_SUMMARY.md` | Understanding architecture |
| `CLAUDE.md` | Full requirements |
| `README.md` | Project overview |

---

## üîó API Endpoints (All Defined, Not Implemented)

### Auth
- `POST /api/auth/login` - Login
- `POST /api/auth/register` - Register
- `POST /api/auth/logout` - Logout
- `GET /api/auth/me` - Current user
- `POST /api/auth/forgot-password` - Request reset
- `POST /api/auth/reset-password` - Reset password

### Courses
- `GET /api/courses` - List courses
- `POST /api/courses` - Create course
- `GET /api/courses/active` - Get active course
- `GET /api/courses/:id` - Get course
- `PUT /api/courses/:id` - Update course
- `DELETE /api/courses/:id` - Delete course

### Injections
- `GET /api/injections` - List injections
- `POST /api/injections` - **Log injection (PRIMARY FEATURE)**
- `GET /api/injections/recent` - Recent injections
- `GET /api/injections/:id` - Get injection
- `PUT /api/injections/:id` - Update injection
- `DELETE /api/injections/:id` - Delete injection

### Inventory
- `GET /api/inventory` - Get stock levels
- `PUT /api/inventory/:type` - Update stock
- `GET /api/inventory/:type/history` - View history
- `POST /api/inventory/:type/adjust` - Manual adjustment
- `GET /api/inventory/alerts` - Low stock alerts

---

## üí° Pro Tips

1. **Start with login** - You need auth before anything else
2. **Test with curl** - Faster than building UI first
3. **Use prepared statements** - SQL injection prevention
4. **Log everything** - Audit table for debugging
5. **Check security headers** - Use curl -I frequently
6. **Backup often** - `make backup` before big changes
7. **Read GETTING_STARTED.md** - Detailed implementation guide
8. **Use transactions** - For inventory auto-decrement

---

## ‚úÖ Verification Checklist

Before implementing features, verify:
- [ ] Application compiles: `go build ./cmd/server`
- [ ] Health check works: `curl localhost:8080/health`
- [ ] Database exists: `ls data/tracker.db`
- [ ] Migrations applied: `sqlite3 data/tracker.db ".tables"`
- [ ] Docker builds: `docker-compose build`
- [ ] Secrets generated: `cat .env | grep SECRET`
- [ ] Security headers present: `curl -I localhost:8080`

---

## üéØ Success Metrics

Your implementation is successful when:
- Login takes < 2 seconds
- Injection logging takes < 5 seconds
- Rate limiting blocks after 5 attempts
- CSRF blocks unauthorized requests
- All tests pass
- Database queries < 50ms
- No SQL injection vulnerabilities
- Audit logs capture all changes

---

**Current Status**: Foundation Complete (25%) ‚úÖ
**Next Milestone**: Authentication + Injection Logging
**Time to MVP**: 6-8 weeks

**Good luck!** üöÄ