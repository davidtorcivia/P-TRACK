{{define "notification_toast"}}
<!-- Toast Notification Component -->
<div x-data="toastManager()"
     @toast.window="showToast($event.detail)"
     style="position: fixed; top: 1rem; right: 1rem; z-index: 9999; width: 100%; max-width: 400px;">

    <template x-for="(toast, index) in toasts" :key="toast.id">
        <div x-show="toast.visible"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-x-full"
             x-transition:enter-end="opacity-100 transform translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="toast"
             :class="'toast-' + toast.type"
             style="margin-bottom: 1rem;">

            <article style="margin: 0;">
                <header style="display: flex; justify-content: space-between; align-items: start;">
                    <strong x-text="toast.title"></strong>
                    <button @click="removeToast(toast.id)"
                            style="background: none; border: none; font-size: 1.25rem; cursor: pointer; padding: 0; line-height: 1;"
                            aria-label="Close">
                        âœ•
                    </button>
                </header>
                <p x-text="toast.message" style="margin: 0.5rem 0 0 0;"></p>
            </article>
        </div>
    </template>
</div>

<script>
function toastManager() {
    return {
        toasts: [],
        nextId: 1,

        showToast(data) {
            const toast = {
                id: this.nextId++,
                title: data.title || 'Notification',
                message: data.message || '',
                type: data.type || 'info', // success, danger, warning, info
                visible: true
            };

            this.toasts.push(toast);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                this.removeToast(toast.id);
            }, data.duration || 5000);
        },

        removeToast(id) {
            const index = this.toasts.findIndex(t => t.id === id);
            if (index !== -1) {
                this.toasts[index].visible = false;
                setTimeout(() => {
                    this.toasts.splice(index, 1);
                }, 200);
            }
        }
    };
}

// Helper function to trigger toasts from anywhere
function showToast(title, message, type = 'info', duration = 5000) {
    window.dispatchEvent(new CustomEvent('toast', {
        detail: { title, message, type, duration }
    }));
}

// HTMX integration - show toasts on HTMX responses
document.body.addEventListener('htmx:afterRequest', function(event) {
    const response = event.detail.xhr.response;
    try {
        const data = JSON.parse(response);
        if (data.toast) {
            showToast(data.toast.title, data.toast.message, data.toast.type);
        }
    } catch (e) {
        // Not a JSON response, ignore
    }
});

// Show error toasts on HTMX errors
document.body.addEventListener('htmx:responseError', function(event) {
    showToast('Error', 'An error occurred. Please try again.', 'danger');
});
</script>

<style>
    .toast article {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 0.5rem;
    }

    .toast-success article {
        border-left: 4px solid var(--success);
        background-color: rgba(16, 185, 129, 0.1);
    }

    .toast-danger article {
        border-left: 4px solid var(--danger);
        background-color: rgba(239, 68, 68, 0.1);
    }

    .toast-warning article {
        border-left: 4px solid var(--warning);
        background-color: rgba(245, 158, 11, 0.1);
    }

    .toast-info article {
        border-left: 4px solid var(--info);
        background-color: rgba(59, 130, 246, 0.1);
    }

    @media (max-width: 768px) {
        .toast {
            max-width: calc(100vw - 2rem);
        }
    }
</style>
{{end}}