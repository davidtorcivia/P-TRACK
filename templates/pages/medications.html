{{ define "content" }}
<div class="container py-8">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl lg:text-4xl font-bold mb-2">Medications</h1>
        <p class="text-lg text-secondary">Track pills, supplements, and other medications</p>
    </div>

    <!-- Quick Actions -->
    <div class="flex flex-wrap gap-3 mb-8">
        <button onclick="window.location.href='/medications/new'" class="btn btn-primary">
            <span class="mr-2">‚ûï</span>
            Add Medication
        </button>
        <button onclick="window.location.href='/medications'" class="btn btn-outline">
            <span class="mr-2">üíä</span>
            Log Medication
        </button>
    </div>

    <!-- Active Medications -->
    <div class="mb-8">
        <h2 class="text-2xl font-semibold mb-6">Active Medications</h2>

        {{ if .ActiveMedications }}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {{ range .ActiveMedications }}
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">{{ .Name }}</h3>
                    <p class="card-subtitle">{{ .Dosage }} ‚Ä¢ {{ .Frequency }}</p>
                </div>
                <div class="card-body">
                    <!-- Today's Status -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium">Today</span>
                            {{ if .TakenToday }}
                            <span class="badge badge-success">‚úì Taken</span>
                            {{ else }}
                            <span class="badge badge-warning">‚è∞ Pending</span>
                            {{ end }}
                        </div>

                        <!-- Quick Log Button -->
                        <form method="POST" action="/api/medications/{{ .ID }}/log">
                            <input type="hidden" name="taken" value="{{ if not .TakenToday }}true{{ else }}false{{ end }}">
                            <button type="submit" class="btn {{ if .TakenToday }}btn-secondary{{ else }}btn-primary{{ end }} w-full">
                                {{ if .TakenToday }}
                                Mark as Missed
                                {{ else }}
                                Mark as Taken
                                {{ end }}
                            </button>
                        </form>
                    </div>

                    <!-- Medication Details -->
                    <div class="space-y-2 text-sm">
                        {{ if .Notes }}
                        <div>
                            <span class="font-medium">Notes:</span>
                            <p class="text-muted">{{ .Notes }}</p>
                        </div>
                        {{ end }}

                        {{ if .StartDate }}
                        <div>
                            <span class="font-medium">Started:</span>
                            <span class="text-muted">{{ .StartDate }}</span>
                        </div>
                        {{ end }}
                    </div>
                </div>
                <div class="card-footer">
                    <button onclick="editMedication({{ .ID }})" class="btn btn-sm btn-ghost">
                        ‚úèÔ∏è Edit
                    </button>
                </div>
            </div>
            {{ end }}
        </div>
        {{ else }}
        <div class="card">
            <div class="card-body text-center py-12">
                <div class="text-4xl mb-4">üíä</div>
                <h3 class="text-lg font-semibold mb-2">No active medications</h3>
                <p class="text-muted mb-4">Add your first medication to start tracking.</p>
                <button onclick="window.location.href='/medications/new'" class="btn btn-primary">
                    <span class="mr-2">‚ûï</span>
                    Add First Medication
                </button>
            </div>
        </div>
        {{ end }}
    </div>

    <!-- Inactive Medications -->
    {{ if .InactiveMedications }}
    <div>
        <h2 class="text-2xl font-semibold mb-6">Past Medications</h2>
        <div class="card">
            <div class="card-body">
                <div class="space-y-4">
                    {{ range .InactiveMedications }}
                    <div class="flex items-center justify-between p-4 bg-surface rounded-lg">
                        <div>
                            <h4 class="font-medium">{{ .Name }}</h4>
                            <p class="text-sm text-muted">{{ .Dosage }} ‚Ä¢ {{ .Frequency }}</p>
                            {{ if .EndDate }}
                            <p class="text-xs text-muted">Ended: {{ .EndDate }}</p>
                            {{ end }}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="reactivateMedication({{ .ID }})" class="btn btn-sm btn-outline">
                                Reactivate
                            </button>
                            <button onclick="editMedication({{ .ID }})" class="btn btn-sm btn-ghost">
                                ‚úèÔ∏è
                            </button>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
    {{ end }}
</div>

<script>
function editMedication(id) {
    // TODO: Implement edit modal
    console.log('Edit medication:', id);
}

function reactivateMedication(id) {
    if (confirm('Reactivate this medication?')) {
        fetch(`/api/medications/${id}}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
            },
            body: JSON.stringify({
                is_active: true
            })
        })
        .then(response => {
            if (response.ok) {
                window.location.reload();
            } else {
                alert('Failed to reactivate medication');
            }
        })
        .catch(error => {
            alert('Error: ' + error.message);
        });
    }
}
</script>
{{ end }}